<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FinanceTracker</title>

    <style>
      /* Reset de m√°rgenes y paddings */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* Estilo del cuerpo */
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%);
        min-height: 100vh;
        padding: 20px;
      }

      a {
        text-decoration: none;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        display: flex;
        min-height: 90vh;
      }

      .sidebar {
        width: 240px;
        background: #f8f9ff;
        padding: 20px;
        border-right: 1px solid #e0e6ed;
      }

      .logo {
        width: 60px;
        height: 60px;
        background: #4285f4;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        color: white;
        font-size: 20px;
        font-weight: bold;
      }

      .logo::before {
        content: "$";
        margin-right: 0;
        font-size: 20px;
      }

      .nav-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        margin-bottom: 8px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
        color: #64748b;
      }

      .nav-item:hover {
        background: #e2e8f0;
        color: #2563eb;
      }

      .nav-item.active {
        background: #dbeafe;
        color: #2563eb;
      }

      .nav-item::before {
        margin-right: 12px;
        font-size: 18px;
      }

      .nav-item.inicio::before {
        content: "üè†";
      }

      .nav-item.movimiento::before {
        content: "üí≥";
      }

      .nav-item.presupuesto::before {
        content: "üìä";
      }

      .nav-item.reportes::before {
        content: "üìà";
      }

      .main-content {
        flex: 1;
        padding: 30px;
        background: #fafbfc;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }

      .welcome {
        font-size: 24px;
        font-weight: 600;
        color: #1e293b;
      }

      .header-actions {
        display: flex;
        gap: 12px;
      }

      .search-bar {
        position: relative;
        width: 300px;
      }

      .search-bar input {
        width: 100%;
        padding: 12px 16px 12px 40px;
        border: 1px solid #e2e8f0;
        border-radius: 25px;
        font-size: 14px;
        background: white;
      }

      .search-bar::before {
        content: "üîç";
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 16px;
        color: #64748b;
      }

      .filter-btn {
        padding: 10px 16px;
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 25px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #64748b;
      }

      .filter-btn:hover {
        background: #f8fafc;
      }

      .movements-section {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 600;
        color: #1e293b;
      }

      .add-btn {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .add-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      }

      .movement-item {
        display: flex;
        align-items: center;
        padding: 16px 0;
        border-bottom: 1px solid #f1f5f9;
        transition: all 0.2s;
      }

      .movement-item:hover {
        background: #f8fafc;
        margin: 0 -25px;
        padding: 16px 25px;
        border-radius: 8px;
      }

      .movement-item:last-child {
        border-bottom: none;
      }

      .movement-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 16px;
        font-size: 20px;
        position: relative;
      }

      .movement-icon.income {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
      }

      .movement-icon.expense {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
      }

      .movement-details {
        flex: 1;
      }

      .movement-name {
        font-size: 16px;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 4px;
      }

      .movement-category {
        font-size: 12px;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 2px;
      }

      .movement-date {
        font-size: 12px;
        color: #94a3b8;
      }

      .movement-amount {
        font-size: 18px;
        font-weight: 700;
        text-align: right;
      }

      .movement-amount.income {
        color: #059669;
      }

      .movement-amount.expense {
        color: #dc2626;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 450px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 25px;
      }

      .modal-header .title-section {
        display: flex;
        align-items: center;
      }

      .modal-header .icon {
        width: 40px;
        height: 40px;
        background: #2563eb;
        color: white;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        font-size: 20px;
      }

      .modal-title {
        font-size: 18px;
        font-weight: 600;
        color: #1e293b;
      }

      .close-btn {
        background: none;
        border: none;
        font-size: 24px;
        color: #64748b;
        cursor: pointer;
        padding: 4px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-size: 14px;
        font-weight: 500;
        color: #374151;
      }

      .form-input,
      .form-select {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #d1d5db;
        border-radius: 10px;
        font-size: 14px;
        transition: all 0.2s;
      }

      .form-input:focus,
      .form-select:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .type-toggle {
        display: flex;
        background: #f1f5f9;
        border-radius: 10px;
        padding: 4px;
        margin-bottom: 20px;
      }

      .type-toggle button {
        flex: 1;
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        background: transparent;
        color: #64748b;
      }

      .type-toggle button.active {
        background: white;
        color: #1e293b;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .btn-primary {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #64748b;
      }

      .empty-state .icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .balance-summary {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }

      .balance-card {
        background: white;
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        text-align: center;
      }

      .balance-card.total {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
      }

      .balance-card.income {
        border-left: 4px solid #10b981;
      }

      .balance-card.expense {
        border-left: 4px solid #ef4444;
      }

      .balance-label {
        font-size: 12px;
        opacity: 0.8;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .balance-amount {
        font-size: 24px;
        font-weight: 700;
      }

      .balance-card.income .balance-amount {
        color: #059669;
      }

      .balance-card.expense .balance-amount {
        color: #dc2626;
      }

      @media (max-width: 768px) {
        .container {
          flex-direction: column;
          margin: 10px;
          border-radius: 15px;
        }

        .sidebar {
          width: 100%;
          padding: 15px;
        }

        .main-content {
          padding: 20px;
        }

        .balance-summary {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .search-bar {
          width: 100%;
          margin-bottom: 10px;
        }

        .header {
          flex-direction: column;
          align-items: stretch;
          gap: 15px;
        }

        .header-actions {
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="logo"></div>
        <a href="dashboard.html" class="nav-item active inicio">INICIO</a>
        <a href="movimiento.html" class="nav-item movimiento">MOVIMIENTO</a>
        <a href="presupuesto.html" class="nav-item presupuesto">PRESUPUESTO</a>
        <a href="reportes.html" class="nav-item reportes">REPORTES</a>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <div class="header">
          <h1 class="welcome">Movimientos Recientes</h1>
          <div class="header-actions">
            <div class="search-bar">
              <input
                type="text"
                id="searchInput"
                placeholder="Buscar movimientos..."
                onkeyup="filterMovements()"
              />
            </div>
            <div class="filter-btn" onclick="toggleFilters()">
              <span>Filtros</span>
              <span>‚¨á</span>
            </div>
          </div>
        </div>

        <!-- Balance Summary -->
        <div class="balance-summary">
          <div class="balance-card total">
            <div class="balance-label">Balance Total</div>
            <div class="balance-amount" id="totalBalance">S/ 0</div>
          </div>
          <div class="balance-card income">
            <div class="balance-label">Ingresos</div>
            <div class="balance-amount" id="totalIncome">S/ 0</div>
          </div>
          <div class="balance-card expense">
            <div class="balance-label">Gastos</div>
            <div class="balance-amount" id="totalExpense">S/ 0</div>
          </div>
        </div>

        <!-- Movements Section -->
        <div class="movements-section">
          <div class="section-header">
            <h2 class="section-title">Todos los Movimientos</h2>
            <button class="add-btn" onclick="openModal()">
              <span>+</span>
              Agregar Movimiento
            </button>
          </div>

          <div id="movementsList">
            <!-- Los movimientos se cargar√°n aqu√≠ din√°micamente -->
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para agregar/editar movimiento -->
    <div class="modal" id="movementModal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="title-section">
            <div class="icon">üí≥</div>
            <h3 class="modal-title">Nuevo Movimiento</h3>
          </div>
          <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>

        <form id="movementForm">
          <div class="type-toggle">
            <button
              type="button"
              id="incomeBtn"
              class="active"
              onclick="setType('income')"
            >
              Ingreso
            </button>
            <button type="button" id="expenseBtn" onclick="setType('expense')">
              Gasto
            </button>
          </div>

          <div class="form-group">
            <label class="form-label">Descripci√≥n</label>
            <input
              type="text"
              class="form-input"
              id="description"
              placeholder="Ej: Pago mensual"
              required
            />
          </div>

          <div class="form-group">
            <label class="form-label">Monto</label>
            <input
              type="number"
              class="form-input"
              id="amount"
              placeholder="0.00"
              step="0.01"
              required
            />
          </div>

          <div class="form-group">
            <label class="form-label">Categor√≠a</label>
            <select class="form-select" id="category" required>
              <option value="">Seleccionar categor√≠a</option>
              <!-- Las opciones se cargar√°n din√°micamente seg√∫n el tipo -->
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Fecha</label>
            <input type="date" class="form-input" id="date" required />
          </div>

          <button type="submit" class="btn-primary">Guardar Movimiento</button>
        </form>
      </div>
    </div>

    <script>
      // Variables globales
      let movements = JSON.parse(localStorage.getItem("movements")) || [];
      let currentType = "income";
      let editingIndex = -1;

      // Categor√≠as predefinidas
      const categories = {
        income: [
          { value: "salario", label: "Salario", icon: "üí∞" },
          { value: "freelance", label: "Freelance", icon: "üíª" },
          { value: "inversion", label: "Inversi√≥n", icon: "üìà" },
          { value: "venta", label: "Venta", icon: "üè∑Ô∏è" },
          { value: "regalo", label: "Regalo", icon: "üéÅ" },
          { value: "otro", label: "Otro", icon: "üìã" },
        ],
        expense: [
          { value: "alimentacion", label: "Alimentaci√≥n", icon: "üçï" },
          { value: "transporte", label: "Transporte", icon: "üöó" },
          { value: "salud", label: "Salud", icon: "üè•" },
          { value: "entretenimiento", label: "Entretenimiento", icon: "üé¨" },
          { value: "servicios", label: "Servicios", icon: "üí°" },
          { value: "compras", label: "Compras", icon: "üõçÔ∏è" },
          { value: "educacion", label: "Educaci√≥n", icon: "üìö" },
          { value: "otro", label: "Otro", icon: "üìã" },
        ],
      };

      // Inicializar la aplicaci√≥n
      document.addEventListener("DOMContentLoaded", function () {
        initApp();
      });

      function initApp() {
        // Establecer fecha actual por defecto
        document.getElementById("date").value = new Date()
          .toISOString()
          .split("T")[0];

        // Cargar categor√≠as iniciales
        loadCategories();

        // Renderizar movimientos
        renderMovements();

        // Actualizar balance
        updateBalance();

        // Si no hay movimientos, agregar algunos de ejemplo
        if (movements.length === 0) {
          addSampleData();
        }
      }

      function addSampleData() {
        const sampleMovements = [
          {
            type: "income",
            description: "Pago mensual",
            amount: 20000,
            category: "salario",
            date: "2025-06-30",
            id: Date.now() + 1,
          },
          {
            type: "expense",
            description: "Supermercado Plaza Vea",
            amount: 500,
            category: "alimentacion",
            date: "2025-05-24",
            id: Date.now() + 2,
          },
          {
            type: "expense",
            description: "Cl√≠nica San Gabriel",
            amount: 300,
            category: "salud",
            date: "2025-05-14",
            id: Date.now() + 3,
          },
          {
            type: "expense",
            description: "PRIMAX",
            amount: 200,
            category: "transporte",
            date: "2025-05-10",
            id: Date.now() + 4,
          },
          {
            type: "expense",
            description: "Netflix",
            amount: 50,
            category: "entretenimiento",
            date: "2025-05-02",
            id: Date.now() + 5,
          },
        ];

        movements = sampleMovements;
        saveMovements();
        renderMovements();
        updateBalance();
      }

      function loadCategories() {
        const categorySelect = document.getElementById("category");
        const currentCategories = categories[currentType];

        categorySelect.innerHTML =
          '<option value="">Seleccionar categor√≠a</option>';

        currentCategories.forEach((cat) => {
          const option = document.createElement("option");
          option.value = cat.value;
          option.textContent = `${cat.icon} ${cat.label}`;
          categorySelect.appendChild(option);
        });
      }

      function setType(type) {
        currentType = type;

        // Actualizar botones
        document
          .getElementById("incomeBtn")
          .classList.toggle("active", type === "income");
        document
          .getElementById("expenseBtn")
          .classList.toggle("active", type === "expense");

        // Recargar categor√≠as
        loadCategories();
      }

      function openModal() {
        editingIndex = -1;
        document.getElementById("movementModal").classList.add("active");
        document.querySelector(".modal-title").textContent = "Nuevo Movimiento";
        document.getElementById("movementForm").reset();
        document.getElementById("date").value = new Date()
          .toISOString()
          .split("T")[0];
        setType("income");
      }

      function closeModal() {
        document.getElementById("movementModal").classList.remove("active");
        document.getElementById("movementForm").reset();
        editingIndex = -1;
      }

      function editMovement(index) {
        editingIndex = index;
        const movement = movements[index];

        document.getElementById("movementModal").classList.add("active");
        document.querySelector(".modal-title").textContent =
          "Editar Movimiento";

        setType(movement.type);
        document.getElementById("description").value = movement.description;
        document.getElementById("amount").value = movement.amount;
        document.getElementById("category").value = movement.category;
        document.getElementById("date").value = movement.date;
      }

      function deleteMovement(index) {
        if (confirm("¬øEst√°s seguro de que quieres eliminar este movimiento?")) {
          movements.splice(index, 1);
          saveMovements();
          renderMovements();
          updateBalance();
        }
      }

      document
        .getElementById("movementForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const formData = {
            type: currentType,
            description: document.getElementById("description").value,
            amount: parseFloat(document.getElementById("amount").value),
            category: document.getElementById("category").value,
            date: document.getElementById("date").value,
            id: editingIndex >= 0 ? movements[editingIndex].id : Date.now(),
          };

          if (editingIndex >= 0) {
            movements[editingIndex] = formData;
          } else {
            movements.unshift(formData);
          }

          saveMovements();
          renderMovements();
          updateBalance();
          closeModal();
        });

      function saveMovements() {
        localStorage.setItem("movements", JSON.stringify(movements));
      }

      function renderMovements() {
        const container = document.getElementById("movementsList");

        if (movements.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üí≥</div>
                        <p>No hay movimientos registrados</p>
                        <p>Agrega tu primer movimiento para comenzar</p>
                    </div>
                `;
          return;
        }

        // Ordenar por fecha (m√°s recientes primero)
        const sortedMovements = [...movements].sort(
          (a, b) => new Date(b.date) - new Date(a.date)
        );

        container.innerHTML = sortedMovements
          .map((movement, index) => {
            const category = categories[movement.type].find(
              (cat) => cat.value === movement.category
            );
            const icon = category ? category.icon : "üìã";
            const categoryLabel = category ? category.label : movement.category;
            const originalIndex = movements.findIndex(
              (m) => m.id === movement.id
            );

            return `
                    <div class="movement-item">
                        <div class="movement-icon ${movement.type}">
                            ${icon}
                        </div>
                        <div class="movement-details">
                            <div class="movement-name">${
                              movement.description
                            }</div>
                            <div class="movement-category">${categoryLabel}</div>
                            <div class="movement-date">${formatDate(
                              movement.date
                            )}</div>
                        </div>
                        <div class="movement-amount ${movement.type}">
                            ${
                              movement.type === "income" ? "+" : "-"
                            } S/ ${movement.amount.toLocaleString("es-PE")}
                        </div>
                        <div style="margin-left: 15px; display: flex; gap: 8px;">
                            <button onclick="editMovement(${originalIndex})" style="background: none; border: none; color: #64748b; cursor: pointer; font-size: 16px;">‚úèÔ∏è</button>
                            <button onclick="deleteMovement(${originalIndex})" style="background: none; border: none; color: #ef4444; cursor: pointer; font-size: 16px;">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function updateBalance() {
        const totalIncome = movements
          .filter((m) => m.type === "income")
          .reduce((sum, m) => sum + m.amount, 0);
        const totalExpense = movements
          .filter((m) => m.type === "expense")
          .reduce((sum, m) => sum + m.amount, 0);
        const balance = totalIncome - totalExpense;

        document.getElementById(
          "totalBalance"
        ).textContent = `S/ ${balance.toLocaleString("es-PE")}`;
        document.getElementById(
          "totalIncome"
        ).textContent = `S/ ${totalIncome.toLocaleString("es-PE")}`;
        document.getElementById(
          "totalExpense"
        ).textContent = `S/ ${totalExpense.toLocaleString("es-PE")}`;
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("es-PE", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
        });
      }

      function filterMovements() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const filteredMovements = movements.filter(
          (movement) =>
            movement.description.toLowerCase().includes(searchTerm) ||
            movement.category.toLowerCase().includes(searchTerm)
        );

        // Renderizar movimientos filtrados (simplificado para este ejemplo)
        if (searchTerm === "") {
          renderMovements();
        } else {
          const container = document.getElementById("movementsList");
          const sortedMovements = [...filteredMovements].sort(
            (a, b) => new Date(b.date) - new Date(a.date)
          );

          if (sortedMovements.length === 0) {
            container.innerHTML = `
                        <div class="empty-state">
                            <div class="icon">üîç</div>
                            <p>No se encontraron movimientos</p>
                            <p>Intenta con otros t√©rminos de b√∫squeda</p>
                        </div>
                    `;
            return;
          }

          container.innerHTML = sortedMovements
            .map((movement) => {
              const category = categories[movement.type].find(
                (cat) => cat.value === movement.category
              );
              const icon = category ? category.icon : "üìã";
              const categoryLabel = category
                ? category.label
                : movement.category;
              const originalIndex = movements.findIndex(
                (m) => m.id === movement.id
              );

              return `
                        <div class="movement-item">
                            <div class="movement-icon ${movement.type}">
                                ${icon}
                            </div>
                            <div class="movement-details">
                                <div class="movement-name">${
                                  movement.description
                                }</div>
                                <div class="movement-category">${categoryLabel}</div>
                                <div class="movement-date">${formatDate(
                                  movement.date
                                )}</div>
                            </div>
                            <div class="movement-amount ${movement.type}">
                                ${
                                  movement.type === "income" ? "+" : "-"
                                } S/ ${movement.amount.toLocaleString("es-PE")}
                            </div>
                            <div style="margin-left: 15px; display: flex; gap: 8px;">
                                <button onclick="editMovement(${originalIndex})" style="background: none; border: none; color: #64748b; cursor: pointer; font-size: 16px;">‚úèÔ∏è</button>
                                <button onclick="deleteMovement(${originalIndex})" style="background: none; border: none; color: #ef4444; cursor: pointer; font-size: 16px;">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
            })
            .join("");
        }
      }

      function toggleFilters() {
        // Funci√≥n para mostrar/ocultar filtros adicionales
        alert("Funci√≥n de filtros avanzados - Pr√≥ximamente disponible");
      }

      function switchSection(section) {
        // Remover clase active de todos los nav-items
        document.querySelectorAll(".nav-item").forEach((item) => {
          item.classList.remove("active");
        });

        // Agregar clase active al nav-item seleccionado
        document.querySelector(`.nav-item.${section}`).classList.add("active");

        // Aqu√≠ podr√≠as agregar l√≥gica para cambiar el contenido seg√∫n la secci√≥n
        if (section !== "movimiento") {
          alert(`Secci√≥n ${section} - Pr√≥ximamente disponible`);
        }
      }

      // Cerrar modal al hacer clic fuera de √©l
      document
        .getElementById("movementModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeModal();
          }
        });

      // Atajos de teclado
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeModal();
        }
        if (e.key === "n" && e.ctrlKey) {
          e.preventDefault();
          openModal();
        }
      });

      // Funci√≥n para exportar datos (bonus)
      function exportData() {
        const dataStr = JSON.stringify(movements, null, 2);
        const dataBlob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement("a");
        link.href = url;
        link.download = "movimientos_financieros.json";
        link.click();
      }

      // Funci√≥n para importar datos (bonus)
      function importData(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              const importedMovements = JSON.parse(e.target.result);
              if (
                confirm("¬øQuieres reemplazar todos los movimientos actuales?")
              ) {
                movements = importedMovements;
                saveMovements();
                renderMovements();
                updateBalance();
                alert("Datos importados exitosamente");
              }
            } catch (error) {
              alert(
                "Error al importar los datos. Verifica que el archivo sea v√°lido."
              );
            }
          };
          reader.readAsText(file);
        }
      }

      // Agregar funcionalidad de validaci√≥n mejorada
      document.getElementById("amount").addEventListener("input", function (e) {
        let value = e.target.value;
        if (value < 0) {
          e.target.value = Math.abs(value);
        }
      });

      // Funci√≥n para generar resumen mensual
      function getMonthlyStats() {
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();

        const monthlyMovements = movements.filter((movement) => {
          const movementDate = new Date(movement.date);
          return (
            movementDate.getMonth() === currentMonth &&
            movementDate.getFullYear() === currentYear
          );
        });

        const monthlyIncome = monthlyMovements
          .filter((m) => m.type === "income")
          .reduce((sum, m) => sum + m.amount, 0);

        const monthlyExpense = monthlyMovements
          .filter((m) => m.type === "expense")
          .reduce((sum, m) => sum + m.amount, 0);

        return {
          income: monthlyIncome,
          expense: monthlyExpense,
          balance: monthlyIncome - monthlyExpense,
          count: monthlyMovements.length,
        };
      }

      // Funci√≥n para mostrar estad√≠sticas por categor√≠a
      function getCategoryStats() {
        const stats = {};

        movements.forEach((movement) => {
          if (!stats[movement.category]) {
            stats[movement.category] = {
              income: 0,
              expense: 0,
              count: 0,
            };
          }

          stats[movement.category][movement.type] += movement.amount;
          stats[movement.category].count++;
        });

        return stats;
      }

      // Funci√≥n para backup autom√°tico
      function autoBackup() {
        const backupKey = `movements_backup_${
          new Date().toISOString().split("T")[0]
        }`;
        localStorage.setItem(backupKey, JSON.stringify(movements));

        // Limpiar backups antiguos (mantener solo los √∫ltimos 7 d√≠as)
        const keys = Object.keys(localStorage);
        const backupKeys = keys.filter((key) =>
          key.startsWith("movements_backup_")
        );

        if (backupKeys.length > 7) {
          backupKeys.sort();
          backupKeys.slice(0, -7).forEach((key) => {
            localStorage.removeItem(key);
          });
        }
      }

      // Ejecutar backup autom√°tico cada vez que se guarden movimientos
      const originalSaveMovements = saveMovements;
      saveMovements = function () {
        originalSaveMovements();
        autoBackup();
      };

      // Animaciones suaves para las transiciones
      function addSlideAnimation(element) {
        element.style.opacity = "0";
        element.style.transform = "translateY(20px)";

        setTimeout(() => {
          element.style.transition = "all 0.3s ease";
          element.style.opacity = "1";
          element.style.transform = "translateY(0)";
        }, 10);
      }

      // Agregar notificaciones toast
      function showToast(message, type = "success") {
        const toast = document.createElement("div");
        toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === "success" ? "#10b981" : "#ef4444"};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            `;

        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => {
          toast.style.transform = "translateX(0)";
        }, 10);

        setTimeout(() => {
          toast.style.transform = "translateX(100%)";
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 300);
        }, 3000);
      }

      // Modificar las funciones para incluir notificaciones
      const originalCloseModal = closeModal;
      closeModal = function () {
        originalCloseModal();
      };

      // Sobrescribir el submit del formulario para agregar notificaci√≥n
      document
        .getElementById("movementForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const formData = {
            type: currentType,
            description: document.getElementById("description").value,
            amount: parseFloat(document.getElementById("amount").value),
            category: document.getElementById("category").value,
            date: document.getElementById("date").value,
            id: editingIndex >= 0 ? movements[editingIndex].id : Date.now(),
          };

          const isEditing = editingIndex >= 0;

          if (editingIndex >= 0) {
            movements[editingIndex] = formData;
          } else {
            movements.unshift(formData);
          }

          saveMovements();
          renderMovements();
          updateBalance();
          closeModal();

          showToast(
            isEditing
              ? "Movimiento actualizado correctamente"
              : "Movimiento agregado correctamente",
            "success"
          );
        });
    </script>
  </body>
</html>
